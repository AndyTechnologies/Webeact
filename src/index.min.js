import express from"express";import path from"path";import{glob}from"glob";import*as fs from"fs";let app=express.Router(),CMPNAME=process.env.COMPONENTS_DIRECTORY||path.join(process.cwd(),"components"),LIBNAME=process.env.LIB_DIRECTORY||path.join(process.cwd(),"Lib");function renderComponent(e,t){let a=fs.readFileSync(CMPNAME+`/${e}.html`,"utf-8");return Object.entries(t).forEach(([e,t])=>{a=a.replace(new RegExp(`{{${e}}`,"g"),t)}),a}async function getFilesNames(){return(await glob(path.join(CMPNAME,"*.*"))).map(e=>e.split("/")).map(e=>e[e.length-1]).map(e=>e.split(".")[0]).map(e=>e.toLowerCase())}function mountWebeact(e){return e.use("/webeact",app),app}app.use(express.static(LIBNAME)),app.get("/component/:name",async(e,t)=>{e=renderComponent(e.params.name,e.query);t.send(""+e)}),app.get("/files",async(e,t)=>{t.send(await getFilesNames())}),app.get("/connect",async(e,t)=>{t.setHeader("Content-Type","text/event-stream"),t.setHeader("Cache-Control","no-cache"),t.setHeader("Connection","keep-alive"),t.write(`data: Webeact SSE

`);let a=e=>{t.write(`event: update
`),t.write(`data: ${JSON.stringify(e)}

`)},n=(a(await getFilesNames()),setInterval(async()=>{a(await getFilesNames())},2500));e.on("close",()=>{clearInterval(n),t.end()})});export default{mountWebeact:mountWebeact,CMPNAME:CMPNAME,LIBNAME:LIBNAME};export{CMPNAME,LIBNAME,mountWebeact};