class Context{constructor(t,e,s){this.dynamicCallbacks=new Map,this.states=[],this.effects=[],this.hookIndex=0,this.callbacks={registerDynamicCallback:this.registerDynamicCallback.bind(this),unregisterDynamicCallback:this.unregisterDynamicCallback.bind(this),useState:this.useState.bind(this),useEffect:this.useEffect.bind(this),useViewTransition:this.useViewTransition.bind(this),useSSE:this.useSSE.bind(this)},this._render=t,this.getAttribute=s,this.hasAttribute=e}registerDynamicCallback(t,e,s=null,i=!0){i&&this.unregisterDynamicCallback(t,e),this.dynamicCallbacks.has(t)||this.dynamicCallbacks.set(t,[]),this.dynamicCallbacks.get(t).push({callback:e,metadata:s,oldData:this.hasAttribute(t)?this.getAttribute(t):null})}unregisterDynamicCallback(t,e){var s;this.dynamicCallbacks.has(t)&&(s=this.dynamicCallbacks.get(t).filter(t=>t.callback===e),this.dynamicCallbacks.set(t,s))}useViewTransition(t,e=()=>{},s=()=>{}){t=document.startViewTransition(t);return t.ready.then(e),t.finished.then(s),t}useSSE(t,e,s,i={}){let a=new EventSource(t);return a.onmessage=e,a.onerror=s,Object.entries(i).forEach((t,e)=>a.addEventListener(t,e)),a}useEffect(t,e){let s=!0;var i=this.hookIndex++;if(this.effects[i]){var[,a]=Array.from(this.effects[i]);if(a.length!==e.length)s=!1;else for(let t=0;t<a.length;t++)if(!Object.is(a[t],e[t])){s=!1;break}}else s=!1;s||(this.effects[i]=[t,e],t(...e))}useState(t){let e=this.hookIndex++;void 0===this.states[e]&&(this.states[e]=t);return[this.states[e],t=>{t="function"==typeof t?t(this.states[e]):t;Object.is(this.states[e],t)||(this.states[e]=t,this._render&&this._render())}]}}export{Context};